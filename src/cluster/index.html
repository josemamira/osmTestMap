
<!DOCTYPE html>
<html>
<head>
	<title>EJEMPLO PAM A PAM </title>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js" integrity="sha512-WXoSHqw/t26DszhdMhOXOkI7qCiv5QWXhH9R7CgvgZMHz1ImlkVQ3uNsiQKu5wwbbxtPzFXd1hK4tzno2VqhpA==" crossorigin=""></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="screen.css" />

	<link rel="stylesheet" href="dist/MarkerCluster.css" />
	<link rel="stylesheet" href="dist/MarkerCluster.Default.css" />
	<script src="dist/leaflet.markercluster-src.js"></script>
	
	

</head>
<body>


    <div id="map"></div>

    <script type="text/javascript">


		var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 18,
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Points &copy 2012 LINZ'
			}),
			latlng = L.latLng(38.974,-0.481);// centro del mapa
		var map = L.map('map', {center: latlng, zoom: 8, layers: [tiles]});
		
		var markers = L.markerClusterGroup({ chunkedLoading: true });

 		// Obtener el JSON
		var requestURL = 'pam.json';
		// ORIGINAL -> https://pamapampv.org/directori-de-punts/?json
		var request = new XMLHttpRequest();
		request.open('GET', requestURL);
		request.responseType = 'json';
		request.send();
		
		// Obtener puntos y adjuntar popup
		request.onload = function() {
			var comercios = request.response;
			var lang='es/';
			
			for (var i = 0; i < comercios.length; i++) {
				var comercio = comercios[i];
				//var title = comercio['post_title'];
				var title = '<h5>'+comercio['post_title']+'</h5>'+
					'<hr>'+comercio['post_content'] + 
					'<br>Horario: <strong>'+ comercio['wpcf-horario'] + '</strong>'+
					'<br>Enlace: <strong><a arget="_blank" href="'+comercio['link']+'">'+comercio['link']+'</a></strong>';
				var marker = L.marker(L.latLng(comercio['latitud'], comercio['longitud']), { title: title });
				marker.bindPopup(title);
				markers.addLayer(marker);
			}	

		 };
		 map.addLayer(markers); 


	</script>
</body>
